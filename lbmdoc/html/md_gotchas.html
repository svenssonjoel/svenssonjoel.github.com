<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LispBM: LBM Gotchas and Caveats</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LispBM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">LBM Gotchas and Caveats </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document collects caveats and gotchas as they are discovered. Hopefully these will also be given efficient solutions at some points in which case the solution to that gotcha will also be documented here.</p>
<p>If you find any more gotchas, please let me know how to trigger them! Would be much appreciated.</p>
<h1>Environment</h1>
<p>In LBM there is a global environment which is an association list of <code>(symbol . value)</code> pairs. There is also a local environment that is carried along in the evaluator while evaluating expressions. This local environment is also an association list <code>(symbol . value)</code> pairs.</p>
<h2>Closure Gotcha!</h2>
<p>When a closure is created, a reference to the local environment is stored in the closure object. This is for efficiency reasons as traversing the expression and pulling in all free variables would be a somewhat costly operation (order of the size of the expression) while saving a reference to the local environment is an O(1) operation. This essentially trades some space (as it potentially prohibits GC from removing some dead values during the life-time of that closure) for improved performance.</p>
<p>Note that the global environment is not "saved" in the same way inside the closure. Given that <code>undefine</code> exists in LBM, this is a potential foot-gun as illustrated by the example below:</p>
<div class="fragment"><div class="line"># (define a 10)</div>
<div class="line">&gt; 10</div>
<div class="line"># (define f (lambda (x) (+ x a)))</div>
<div class="line">&gt; (closure (x) (+ x a) nil)</div>
<div class="line"># (undefine &#39;a)</div>
<div class="line">&gt; ((f closure (x) (+ x a) nil))</div>
<div class="line"># (f 1)</div>
<div class="line">*** Error:  variable_not_bound</div>
<div class="line">***     a</div>
<div class="line"># </div>
<div class="line">*** Between rows: (-1 unknown) </div>
<div class="line">***     Start: -1</div>
<div class="line">***     End:   -1</div>
<div class="line"># </div>
<div class="line">&gt; variable_not_bound</div>
<div class="line">#</div>
</div><!-- fragment --><p>Currently no (efficient) solution in mind for this gotcha. Just be careful if you use <code>undefine</code>.</p>
<h1>Flash memory</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
