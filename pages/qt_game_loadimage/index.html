<HTML>

<HEAD>  

  <TITLE>Loading and displaying images in QT</TITLE>

  <meta charset="UTF-8">
  <meta name="description" content="Loading and displaying images in QT">
  <meta name="keywords" content="Loading PNG qt display qpixmap qgraphicsview">
  <meta name="author" content="Bo Joel Svensson">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script data-ad-client="ca-pub-6663189426712847" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111281599-1"></script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', 'UA-111281599-1');
  </script>

  <link rel="canonical" href="https://svenssonjoel.github.io/pages/qt_game_loadimage/index.html" />

</HEAD> 

<style type="text/css">
  
  body, html {
  margin-left: 5%;
  margin-right: 5%;
  }
  
  
  .topnav {
  overflow: auto;
  white-space: nowrap;
  background-color: #333;
  }
  
  .topnav a {
  display: inline-block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
  }
  
  .topnav a:hover {
  background-color: #ddd;
  color: black;
  }
  
  .topnav a.active {
  background-color: #4CAF50;
  color: white;
  }
  
  
  .hero-image {
  background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("../../images/nerd.jpg");
  height: 50%;  
  /* Position and center the image to scale nicely on all screens */
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  position: relative;
  }

  /* Place text in the middle of the image */
  .hero-text {
  text-align: center;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: gray;
  }
  
  
  
  body, html {
  margin-left: 5%;
  margin-right: 5%;
  font-size: large;
  zoom-level: 150%;
  }
  
  pre {
  background-color: white;
  word-wrap: normal;
  overflow-x: auto;
  white-space: pre;
  margin-left: 2%;
  margin-right: 2%;
  }

  img {
  max-width:100%;
  height:auto;
  }
  
  .yt-link {
  text-align: center;
  }
  
  .yt-link img {
  display: block;
  margin: 0 auto;
  max-width: 100%
  }

  tr:hover {background-color: #8abd8a;}
  

  th {
  background-color: #333;
  color: white;
  }
  
</style>

<BODY bgcolor=#C0C0C0>

<div class="hero-image">
 <div class="hero-text">
   <h1>BLOG</h1>
 </div>
</div>   

<div class="topnav">
  <a href="../../index.html"> Home </a>
  <a href="../../index.html#BLOG"> Blog </a>
  <a href="../../index.html#VIDEOS"> Videos </a>   
  <a href="../../research.html"> Research </a>
  <a href="../../about.html"> About </a>
  <a href="../../privacy_policy.html">Privacy Policy</a>
</div>

<!-- BODY IS INTENTIONALY LEFT OPEN --> 

<h1 id="loading-and-displaying-images-with-qt">Loading and displaying images with QT</h1>
<h2 id="introduction">Introduction</h2>
<p>I have always thought that it is pretty fun to work on small toy games as a way to practice programming. The visual feedback when seeing something happen on screen after writing a bit of code is a good motivator, even if it doesn't turn out exactly as planned.</p>
<p>The source code for this blog post is available on <a href="https://github.com/svenssonjoel/GameExperimentation">Github</a> and since it is written in QT there are autogenerated files (for example from the GUI editor) that I will not show in the blog, but can be found on Github then.</p>
<p>I am not very good at drawing. My wife is though... But I am not. So for now the experiments will be based on a bunch of resources I bought at Steam. These are "royalty free" packs of 2d graphics.</p>
<ol>
<li><a href="https://store.steampowered.com/app/316630/Character_Creator__Graphics_Pack/">Character Creator - Graphics Pack</a></li>
<li><a href="https://store.steampowered.com/app/281900/Indie_Graphics_Bundle__Royalty_Free_Sprites/">Indie Graphics Bundle - Royalty Free Sprites</a></li>
<li><a href="https://store.steampowered.com/app/316620/Space_Galaxy__Graphics_Pack/">Space Galaxy - Graphics Pack</a></li>
</ol>
<p>As I understand it, I am free to use these in for example any screenshots I post here, or any games I make. But I am of course not allowed to share the packs in their raw form with anyone else. Which is a bit odd because any resource used in a game could of course be extracted from there by a sufficiently sophisticated person, thus gaining access to the raw data. Will I then be of fault?</p>
<p>Feedback, hints, tips, questions, are all very welcome. I do not think that is hard for anyone that is motivated enough to look, to find my email address.</p>
<h2 id="viewing-an-image">Viewing an image</h2>
<p>This first experimenting into the realm of "game" programming based on QT is a simple image viewer. The result looks like the picture below.</p>
<p><img src="./media/Spacestation.png" /></p>
<p>There are just two buttons, <code>Load</code> and <code>Clear</code>. The load button brings up a file dialog, selecting a file loads it and displays into a <code>QGraphicsView</code>. The clear button, does what is expected. The layout of the buttons and the <code>QGraphicsView</code> is created with the gui designed in Qt Creator.</p>
<h2 id="the-code">The Code</h2>
<p>The interesting code is located in the files <code>mainwindow.h</code> and <code>mainwindow.cpp</code>. There's only like 10 or so lines of hand-made code in total.</p>
<p>In <code>mainwindow.h</code> I added a <code>mResourceDir</code> variable that will hold the path to the directory where I have stored all those "royalty free graphics" that I linked to above. Other than that only the two "private slots" are interesting. These slots are functions that are called when the buttons are clicked. The rest is autogenerated by Qt Creator.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="pp">#ifndef MAINWINDOW_H</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="pp">#define MAINWINDOW_H</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="pp">#include </span><span class="im">&lt;QMainWindow&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="pp">#include </span><span class="im">&lt;QFileDialog&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="pp">#include </span><span class="im">&lt;QDebug&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>QT_BEGIN_NAMESPACE</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">namespace</span> Ui { <span class="kw">class</span> MainWindow; }</span>
<span id="cb1-10"><a href="#cb1-10"></a>QT_END_NAMESPACE</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="kw">class</span> MainWindow : <span class="kw">public</span> <span class="ex">QMainWindow</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>{</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="ex">Q_OBJECT</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">public</span>:</span>
<span id="cb1-17"><a href="#cb1-17"></a>    MainWindow(<span class="ex">QWidget</span> *parent = <span class="kw">nullptr</span>);</span>
<span id="cb1-18"><a href="#cb1-18"></a>    ~MainWindow();</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw">private</span> <span class="ex">slots</span>:</span>
<span id="cb1-21"><a href="#cb1-21"></a>    <span class="dt">void</span> on_loadPushButton_clicked();</span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="dt">void</span> on_clearPushButton_clicked();</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="kw">private</span>:</span>
<span id="cb1-25"><a href="#cb1-25"></a>    Ui::MainWindow *ui;</span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="ex">QString</span> mResourceDir;</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a>};</span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="pp">#endif </span><span class="co">// MAINWINDOW_H</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span></code></pre></div>
<p>Now, the <code>mainwindow.cpp</code> file. First in the cpp there is a constructor that is called upon the creation of the mainwindow. This function just sets up the <code>mResourceDir</code>.</p>
<p>The userinterface, designed in the gui designer is accessible through the variable called <code>ui</code>. We'll see how this works later when accessing the <code>QGraphicsView</code> which is part of the user interface.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a><span class="pp">#include </span><span class="im">&quot;mainwindow.h&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="pp">#include </span><span class="im">&quot;ui_mainwindow.h&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>MainWindow::MainWindow(<span class="ex">QWidget</span> *parent)</span>
<span id="cb2-5"><a href="#cb2-5"></a>    : <span class="ex">QMainWindow</span>(parent)</span>
<span id="cb2-6"><a href="#cb2-6"></a>    , ui(<span class="kw">new</span> Ui::MainWindow)</span>
<span id="cb2-7"><a href="#cb2-7"></a>{</span>
<span id="cb2-8"><a href="#cb2-8"></a>    ui-&gt;setupUi(<span class="kw">this</span>);</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="co">/* Directory containing:</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">     *  Character Creator - Graphics Pack</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">     *  Indie Graphics Bundle</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">     *  Space Galaxy - Graphics Pack</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">     *</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">     *  All avaialable from Steam at low price!</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">     */</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>    mResourceDir = <span class="st">&quot;../../../Resources&quot;</span>;</span>
<span id="cb2-18"><a href="#cb2-18"></a>}</span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a>MainWindow::~MainWindow()</span>
<span id="cb2-21"><a href="#cb2-21"></a>{</span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="kw">delete</span> ui;</span>
<span id="cb2-23"><a href="#cb2-23"></a>}</span></code></pre></div>
<p>The code below is executed when the <code>Load</code> button is clicked. It opens up a file dialog with that displays "Load Image" in its header. It starts out with the <code>mResourceDir</code> directory opened and filters for images, png and jpg.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="dt">void</span> MainWindow::on_loadPushButton_clicked()</span>
<span id="cb3-2"><a href="#cb3-2"></a>{</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="ex">QString</span> filename = <span class="ex">QFileDialog::</span>getOpenFileName(<span class="kw">this</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                                                    <span class="fu">tr</span>(<span class="st">&quot;Load Image&quot;</span>),</span>
<span id="cb3-5"><a href="#cb3-5"></a>                                                    mResourceDir,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                                                    <span class="fu">tr</span>(<span class="st">&quot;Images (*.png *.jpg)&quot;</span>));</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="cf">if</span> (filename.isEmpty())  {</span>
<span id="cb3-9"><a href="#cb3-9"></a>        <span class="cf">return</span>;</span>
<span id="cb3-10"><a href="#cb3-10"></a>    }</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="ex">QPixmap</span> p(filename);</span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="cf">if</span> (! ui-&gt;graphicsView-&gt;scene()) {</span>
<span id="cb3-14"><a href="#cb3-14"></a>        <span class="fu">qDebug</span>() &lt;&lt; <span class="st">&quot;No Scene!&quot;</span>;</span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a>        <span class="ex">QGraphicsScene</span> *scene = <span class="kw">new</span> <span class="ex">QGraphicsScene</span>(<span class="kw">this</span>);</span>
<span id="cb3-17"><a href="#cb3-17"></a>        ui-&gt;graphicsView-&gt;setScene(scene);</span>
<span id="cb3-18"><a href="#cb3-18"></a>    }</span>
<span id="cb3-19"><a href="#cb3-19"></a>    ui-&gt;graphicsView-&gt;scene()-&gt;addPixmap(p);</span>
<span id="cb3-20"><a href="#cb3-20"></a>}</span></code></pre></div>
<p>If the returned <code>filename</code> string is empty, the method exits. If a file is selected, a pixmap is created <code>QPixmap p(filename)</code> which loads the image file.</p>
<p>Now, the graphicsView is made up out of something called "scenes" and if there is no active "scene" to display in one is created here.</p>
<p>The pixmap is then added to the scene.</p>
<p>The interplay between graphicsViews and scenes is something I need to study a bit to understand.</p>
<p>The code below is executed then the <code>Clear</code> button is clicked. If there is an active scene in the graphicsView, this scene is cleared!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1"></a><span class="dt">void</span> MainWindow::on_clearPushButton_clicked()</span>
<span id="cb4-2"><a href="#cb4-2"></a>{</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="cf">if</span> (ui-&gt;graphicsView-&gt;scene()) {</span>
<span id="cb4-4"><a href="#cb4-4"></a>        ui-&gt;graphicsView-&gt;scene()-&gt;clear();</span>
<span id="cb4-5"><a href="#cb4-5"></a>    }</span>
<span id="cb4-6"><a href="#cb4-6"></a>}</span></code></pre></div>
<h2 id="concluding-thoughts">Concluding thoughts</h2>
<p>There. That seems to be a simple image viewer! Much left to learn ;) small steps.</p>
<p>Any game needs graphics, so loading an image felt like a good start on that journey.</p>
<p>When going forward, though, there a lot of things that need figuring out. What is the best way to compose images to display in Qt? Is there a "pixel level" interface to make use of, or is the preferred way something higher level? What about animations? Are QTimers a good candidate for keeping track of when to switch frame?</p>
<p>Thanks for reading!</p>
<hr />
<p><a href="https://svenssonjoel.github.io">HOME</a></p>
<p>© Copyright 2020 Bo Joel Svensson</p>
<p>This page was generated using <a href=https://pandoc.org/> Pandoc</a>.</p>
</BODY>
</HTML>
